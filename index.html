<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prompt & Keyword Organizer ‚Äî Final</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@500;600&family=Playfair+Display:wght@700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* VARIAN DEFAULT (LIGHT MODE) - DITINGGALKAN SEBAGAI REFERENSI, TAPI TIDAK DIPAKAI STARTUP */
    :root{
      --bg:#f4f5f7;      
      --card:#ffffff;     
      --input:#fff;    
      --border:#ccc;    
      --text:#292828;
      --subtext:#555;
      --accent:#0078d7;   
      --radius:8px;

      /* Soft colors (light) dari input Anda */
      --btn-reset-bg:#fdecea;  --btn-reset-fg:#e74c3c;
      --btn-paste-bg:#f3e8fd;  --btn-paste-fg:#6f42c1;
      --btn-copy-bg:#e6f9ed;   --btn-copy-fg:#2ecc71;
      --btn-gen-bg:#e6f0ff;    --btn-gen-fg:#2f80ed;
      --btn-organize-bg:#e6f0ff; --btn-organize-fg:#2f80ed;
      --btn-select-bg:#fff3e0;  --btn-select-fg:#fb8c00;

      /* Warna kustom untuk tombol spesifik */
      --btn-paste-judul-bg: #fde7f3; --btn-paste-judul-fg: #d63384;
      --btn-gen-prompt-bg: #fff3e0;  --btn-gen-prompt-fg: #fb8c00; /* Orange */

      --notif-copy:#2ecc71;
      --notif-reset:#e74c3c;
    }

    /* VARIAN DARK MODE - DIJADIKAN DEFAULT */
    body[data-theme="dark"]{
      --bg:#0f0f0f;
      --card:#212121;
      --input:#111111;
      --border:#4d5159; 
      --text:#f5f5f5;
      --subtext:#b0b3b8;
      --accent:#61dafb;

      /* Soft colors tuned for dark dari input Anda */
      --btn-reset-bg:#442424;  --btn-reset-fg:#ff6b6b;
      --btn-paste-bg:#3b2a4d;  --btn-paste-fg:#b388eb;
      --btn-copy-bg:#1f3b2f;   --btn-copy-fg:#4cd964;
      --btn-gen-bg:#1e2a44;    --btn-gen-fg:#4da3ff;
      --btn-organize-bg:#1e2a44; --btn-organize-fg:#4da3ff;
      --btn-select-bg:#4d3d24;  --btn-select-fg:#fb8c00;

      /* Warna kustom untuk tombol spesifik (dark) */
      --btn-paste-judul-bg: #4d243d; --btn-paste-judul-fg: #ff85c0; /* Pink (dark) */
      --btn-gen-prompt-bg: #4d3d24;  --btn-gen-prompt-fg: #fb8c00; /* Orange (dark) */

      --notif-copy:#27ae60;
      --notif-reset:#e74c3c;
    }

    *{box-sizing:border-box;font-family:"Poppins",sans-serif;margin:0;padding:0}
    body{
      background:var(--bg);
      color:var(--text);
      transition:background 0.3s, color 0.3s;
      padding:28px 16px;
      line-height: 1.5;
    }

    main{
        max-width:1100px;
        margin:auto;
        display:flex;
        flex-direction:column;
        gap:34px;
    }
    section{
        background:var(--card);
        border-radius:var(--radius);
        padding:20px;
        box-shadow:0 2px 10px rgba(0,0,0,0.2);
    }

    /* === HEADER DAN RESET UTAMA === */
    .section-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:18px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 10px;
    }

    .section-header h2{
      color:var(--text); 
      margin:0;
      font-weight:700; 
      font-size:1.4rem; 
      font-family: 'Playfair Display', serif;
    }
    
    .btn-header-reset {
        background: var(--btn-reset-bg);
        color: var(--btn-reset-fg);
        padding: 6px 10px; 
        font-size: 11px; 
        border-radius: 999px; 
        font-weight: 500;
        height: 30px; 
        flex: 0 0 auto;
        border: none;
        cursor: pointer;
        transition: background-color .2s ease, transform .05s ease;
    }
    .btn-header-reset:hover { filter: brightness(1.1); }
    .btn-header-reset:active { transform: translateY(1px); }

    /* Tombol Theme Toggle */
    #theme-toggle {
        background: var(--btn-select-bg);
        color: var(--btn-select-fg);
    }
    #theme-toggle .icon-sun,
    body[data-theme="dark"] #theme-toggle .icon-moon { display: none; }
    body[data-theme="dark"] #theme-toggle .icon-sun { display: inline-block; }


    /* === INPUT DAN LABEL UMUM === */
    .field-group { margin-bottom: 15px; }
    label{
        display: block;
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--subtext);
        margin-bottom: 6px;
    }
    .label-with-count{
        display: flex;
        justify-content: space-between;
        align-items: flex-end; /* Posisikan count sejajar dengan baseline label */
        margin-bottom: 6px;
    }
    .keyword-count{
        font-size: 0.8rem;
        color: var(--accent);
        font-weight: 600;
    }

    input, textarea{
        background: var(--input);
        border: 1px solid var(--border);
        color: var(--text);
        border-radius: var(--radius); 
        padding: 8px; 
        font-size: 0.9rem; 
        line-height: 1.4;
        width: 100%;
        transition: border-color 0.2s;
        resize: none;
    }
    input:focus, textarea:focus { border-color: var(--accent); outline: none; }
    input { height: 38px; } 
    textarea { min-height: 100px; background: var(--input); border: 1px solid var(--border); } 
    /* Aturan khusus untuk membuat textarea Keyword Awal menjadi satu baris */
    #keywordAwal {
        height: auto; /* Biarkan tinggi menyesuaikan konten */
        min-height: 100px; /* Kembali ke min-height default textarea */
        white-space: normal; /* Memungkinkan teks turun baris */
        overflow-x: hidden; /* Sembunyikan scrollbar horizontal */
    }
    /* === TOMBOL UMUM (Soft Pill, Ringkas) === */
    .button-row{display:flex;flex-wrap:wrap;gap:8px; margin-top:8px;} 
    button{
      /* Properti umum dari kode Anda */
      font-weight:500; 
      border:none; border-radius:999px; cursor:pointer;
      transition:background-color .2s ease, transform .05s ease;
      display:flex; align-items:center; justify-content:center; gap:5px; 
      outline: none;

      /* Properti khusus agar ringkas */
      padding: 5px 10px; 
      font-size: 11px; 
      height: 32px; 
    }
    
    button:hover{ filter: brightness(1.05); } 
    button:active{ transform: translateY(1px); } /* Efek tekan */
    
    /* Warna Tombol (Menggunakan skema Soft/Subtle) */
    .btn-paste-style   { background:var(--btn-paste-bg);  color:var(--btn-paste-fg);}
    .btn-generate-style{ background:var(--btn-gen-bg);    color:var(--btn-gen-fg);}
    .btn-copy-style    { background:var(--btn-copy-bg);   color:var(--btn-copy-fg);}
    .btn-reset-style   { background:var(--btn-reset-bg);  color:var(--btn-reset-fg);}
    .btn-delete-field  { background:var(--btn-reset-bg);  color:var(--btn-reset-fg);}

    /* Tombol dengan warna kustom */
    .btn-paste-judul { background: var(--btn-paste-judul-bg); color: var(--btn-paste-judul-fg); font-weight: 600; }
    .btn-gen-prompt  { background: var(--btn-gen-prompt-bg);  color: var(--btn-gen-prompt-fg); }
    
    .badge-purple { color: #ad56cf; } /* Ungu Cerah */
    .badge-blue { color: #3498db; } /* Biru */
    .badge-green { color: rgb(2, 171, 2); } /* Hijau */
    
    /* === KEYWORD ORGANIZER STYLES === */
    .input-area{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:15px 0}
    
    .keyword-field-container {
        background: var(--card); 
        padding: 10px;
        border-radius: var(--radius);
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    /* Menyesuaikan jarak antara label dan tombol paste/del yang baru di atas */
    .keyword-field-container .keyword-top-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px; 
    }
    /* Mengurangi ukuran ikon di tombol kecil */
    .keyword-field-container .keyword-top-controls .button-row button svg { width: 14px; height: 14px; }

    /* Menjadikan textarea keyword menjadi satu baris */
    .keyword-count-badge {
        background: var(--input);
        color: var(--subtext);
        padding: 4px 10px;
        font-size: 12px;
        border-radius: 999px;
        font-weight: 600;
        border: 1px solid var(--border);
        font-family: 'IBM Plex Mono', monospace;
    }
    .all-keywords-container {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
        margin-bottom: 15px;
    }

    .prompt-keyword-stats {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
        gap: 1px;
        margin-top: 15px;
    }
    /* Style untuk kapsul status keyword */
    .keyword-status-badge {
        padding: 4px 8px;
        font-size: 11px;
        border-radius: 999px;
        font-weight: 700;
        border: 1px solid transparent;
        transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        min-width: 30px;
        text-align: center;
        margin-right: 4px; /* Jarak antar status badge */
        font-family: 'IBM Plex Mono', monospace;
    }
    .keyword-status-badge.status-empty {
        background-color: var(--input);
        color: var(--subtext);
        border-color: var(--border);
    }
    .keyword-status-badge.status-filled {
        background-color: var(--btn-copy-bg);
        color: var(--btn-copy-fg);
        border-color: var(--btn-copy-bg);
    }

    .divider {
        border-top: 1px solid var(--border);
        margin: 20px 0 15px 0;
    }

    .keyword-field-container textarea {
        height: 38px; /* Menyamakan tinggi dengan input field lain */
        min-height: 38px;
        white-space: nowrap; /* Mencegah teks turun baris */
    }

    /* Container baru untuk 3 pasang tombol Paste/Del */
    .keyword-controls-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 12px; /* Jarak ke input area di bawahnya */
    }
    .keyword-controls-grid .keyword-button-pair {
        display: flex;
        gap: 4px;
    }
    .keyword-controls-grid .keyword-button-pair button {
        flex: 1 1 0; /* Memastikan tombol membagi ruang secara merata */
    }
    /* Grid untuk 4 tombol paste */
    .paste-controls-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 8px;
    }
    /* Warna Tombol Keyword Organizer */
    .btn-select-style   { background: var(--btn-gen-bg);   color: var(--btn-gen-fg); } 
    .btn-delete-style   { background: var(--btn-reset-bg);    color: var(--btn-reset-fg); }    
    
    /* Aturan untuk ikon minimize/maximize di Keyword Organizer */
    #keyword-section.minimized .icon-minimize { display: none; }
    #keyword-section:not(.minimized) .icon-maximize { display: none; }
    /* Aturan untuk ikon minimize/maximize di Prompt Keyword iStock */
    #istock-prompt.minimized .icon-minimize { display: none; }
    #istock-prompt:not(.minimized) .icon-maximize { display: none; }

    /* === PROMPT TYPE SELECTOR === */
    .prompt-selector {
        display: flex;
        background: var(--input);
        border-radius: var(--radius);
        padding: 4px;
        border: 1px solid var(--border);
        margin-bottom: 15px;
    }
    .prompt-selector input[type="radio"] {
        display: none;
    }
    .prompt-selector label {
        flex: 1;
        text-align: center;
        padding: 6px 10px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 13px;
        color: var(--subtext);
        transition: all 0.2s ease-in-out;
        margin-bottom: 0;
    }
    .prompt-selector input[type="radio"]:checked + label {
        background: var(--btn-copy-bg);
        color: var(--btn-copy-fg);
        font-weight: 600;
    }

    /* Penyesuaian ukuran selector saat di dalam header */
    .section-header .prompt-selector {
        margin-bottom: 0;
        padding: 3px;
        border-radius: 7px; /* Sedikit lebih kecil dari default */
    }
    .section-header .prompt-selector label {
        padding: 3px 14px; /* Dibuat lebih ringkas */
        font-size: 11px;
        font-weight: 500;
        border-radius: 5px; /* Radius lebih kecil untuk tampilan modern */
    }


    /* HASIL KEYWORD (3 KOLOM) */
    .keywords-result{
      margin-top:8px;
      padding:6px 8px; 
      border-radius:var(--radius);background:var(--input);border:1px solid var(--border);
      min-height:40px;
      
      display: flow-root; 
      column-count: 3;
      column-gap: 10px;
      padding: 10px; 
    }
    
    .keywords-result label{
        font-size:0.9rem;
        color:var(--text);
        cursor:pointer;
        display: block; 
        margin-bottom: 4px; 
        break-inside: avoid; 
    }
    
    /* MODIFIKASI UKURAN CHECKBOX */
    .keywords-result label input[type="checkbox"] {
        margin-right: 5px;
        width: 14px;  /* Mengatur lebar */
        height: 14px; /* Mengatur tinggi */
        vertical-align: middle; /* Memastikan sejajar dengan teks */
        accent-color: var(--accent); /* Memberikan warna aksen (opsional) */
    }


    .bottom-section{
        margin-top:10px; 
        padding:8px; 
        border-radius:var(--radius);
        font-size:0.85rem; 
        background: var(--input);
        border: 1px solid var(--border);
    }

    /* Notifikasi copy */
    #toast {
        background: var(--notif-copy); 
        color:#fff; padding:8px 14px; border-radius:8px;
        position:fixed; top:20px; right:20px;
        font-size:13px; opacity:0; transition:all .25s; z-index:1000;
        transform:translateY(-10px); 
    }
    #toast.show{opacity:1; transform:translateY(0);}
    
    /* === MEDIA QUERIES (RESPONSIVITAS) === */
    @media (max-width:800px){
      .input-area{grid-template-columns:1fr}
      body{padding:16px;}
      
      /* Tombol 100% lebar di mobile */
      .button-row button,
      .keyword-field-container .button-row button,

      /* Di mobile, hasil keyword tampil 1 kolom */
      .keywords-result{ column-count: 1; }
    }

    /* Di layar yang sedikit lebih kecil, tampilkan 2 kolom */
    @media (min-width: 600px) and (max-width: 1000px) {
        .keywords-result{ column-count: 2; }
    }
  </style>
</head>
<body data-theme="dark">

  <h1 style="text-align: center; font-family: 'Helvetica', sans-serif; font-weight: bold; margin-bottom: 15px; color: var(--text);">Tool Keyword</h1>

  <!-- Prompt Type Selector dipindahkan ke sini -->
  <div class="prompt-selector" style="max-width: 250px; margin-left: auto; margin-right: auto;">
      <input type="radio" id="prompt-type-gemini" name="prompt-type" value="gemini" checked>
      <label for="prompt-type-gemini">Gemini</label>
      <input type="radio" id="prompt-type-adobe" name="prompt-type" value="adobe">
      <label for="prompt-type-adobe">Adobe</label>
      <input type="radio" id="prompt-type-istock" name="prompt-type" value="istock">
      <label for="prompt-type-istock">iStock</label>
  </div>

  <main>
    <section id="actions-and-stats">
         <div class="section-header">
             <h2>Actions</h2>
             <div style="display: flex; align-items: center; gap: 8px;">
                 <button class="btn-delete-field btn-header-reset" onclick="clearField('judul')" title="Hapus Judul" style="padding: 6px 10px;">
                     <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6L6 18"/><path d="M6 6l12 12"/></svg>
                     Hapus Jud
                 </button>
                 <button class="btn-header-reset" onclick="resetAll()">
                     <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                     Reset
                 </button>
                 <button id="theme-toggle" class="btn-header-reset" title="Ganti Tema">
                     <span class="icon-moon">üåô</span>
                     <span class="icon-sun">‚òÄÔ∏è</span>
                 </button>
            </div>
         </div>

         <!-- Kontainer baru untuk statistik keyword -->
         <div class="prompt-keyword-stats">
             <!-- Indikator Status Judul -->
             <span id="judul-status" class="keyword-status-badge status-empty">Judul</span>
             <!-- Badge Jumlah Keyword -->
             <span class="keyword-count-badge">K01: <span id="kw1Count" class="badge-purple">0</span></span>
             <span class="keyword-count-badge">K02: <span id="kw2Count" class="badge-purple">0</span></span>
             <span class="keyword-count-badge">K03: <span id="kw3Count" class="badge-purple">0</span></span>
             <span class="keyword-count-badge">All: <span id="allKeywordCount" class="badge-blue">0</span></span>
             <span class="keyword-count-badge">F: <span id="akhirCount" class="badge-green">0</span></span>
         </div>
         <div class="divider"></div>

         <!-- Area baru untuk tombol Paste/Del -->
         <div class="paste-controls-grid" style="margin-top: 15px; margin-bottom: 0;">
             <button class="btn-paste-style btn-paste-judul" onclick="pasteTo('judul')">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 9v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9"/><path d="M7 3h10a2 2 0 012 2v4a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z"/></svg>
                 Judul
             </button>
             <button class="btn-paste-style" onclick="pasteTo('kw1')">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 9v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9"/><path d="M7 3h10a2 2 0 012 2v4a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z"/></svg>
                 Paste 1
             </button>
             <button class="btn-paste-style" onclick="pasteTo('kw2')">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 9v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9"/><path d="M7 3h10a2 2 0 012 2v4a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z"/></svg>
                 Paste 2
             </button>
             <button class="btn-paste-style" onclick="pasteTo('kw3')">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 9v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9"/><path d="M7 3h10a2 2 0 012 2v4a2 2 0 01-2 2H7a2 2 0 01-2-2V5a2 2 0 012-2z"/></svg>
                 Paste 3
             </button>
         </div>
 
         <!-- Container untuk 4 tombol yang sejajar -->
         <div class="divider"></div>

         <!-- Menggunakan grid 4 kolom dari CSS -->
         <div class="paste-controls-grid" style="margin-top: 5px; grid-template-columns: repeat(3, 1fr);">
             <button class="btn-generate-style btn-gen-prompt" onclick="organizeAndGenerate()">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                 Generate
             </button>
             <button class="btn-copy-style" onclick="copyText('hasilPrompt')">
                 <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                 Copy
             </button>
         </div>
     </section>
 
     <section id="istock-prompt">
         <div class="section-header">
             <h2>Prompt Keyword</h2>
             <div style="display:flex; gap:8px;">
                 <button id="toggle-istock-prompt-btn" class="btn-header-reset" title="Buka/Tutup Prompt">
                     <svg class="icon-maximize" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                     <svg class="icon-minimize" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>
                 </button>
             </div>
         </div>
 
        <div id="istock-prompt-content">
            <div class="field-group">
                <label for="judul">Judul iStock:</label>
                <input id="judul" placeholder="Masukkan judul..." oninput="updateKeywordCounts()" />
            </div>
            
            <div class="field-group">
                <label for="keywordAwal">Keyword Awal (Otomatis terisi dari Organizer):</label>
                <textarea id="keywordAwal" oninput="updateKeywordAwalCount()" placeholder="Masukkan keyword awal..."></textarea>
            </div>
            
            <div class="field-group">
                <label for="hasilPrompt">Hasil Prompt iStock:</label>
                <textarea id="hasilPrompt" readonly placeholder="Hasil prompt iStock..."></textarea>
            </div>
        </div>
     </section>

    <section id="keyword-section">
      <div class="section-header">
        <h2>Keyword Organizer</h2>
        <div style="display:flex; gap:8px;">
            <button id="toggle-organizer-btn" class="btn-header-reset" title="Buka/Tutup Organizer">
                <svg class="icon-maximize" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                <svg class="icon-minimize" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>
            </button>
        </div>
      </div>

      <!-- Konten yang bisa di-minimize -->
      <div id="organizer-content">

      <!-- Area untuk tombol DEL -->
      <div class="keyword-controls-grid" style="margin-top: 5px; margin-bottom: 15px;">

        <button class="btn-delete-style" onclick="clearField('kw1')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/></svg>
            DEL 1
        </button>
        <button class="btn-delete-style" onclick="clearField('kw2')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/></svg>
            DEL 2
        </button>
        <button class="btn-delete-style" onclick="clearField('kw3')">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/></svg>
            DEL 3
        </button>
      </div>

      <div class="input-area">
        <div class="keyword-field-container">
          <div class="keyword-top-controls">
            <label for="kw1">Daftar Keyword 1</label>
          </div>
          <textarea id="kw1" oninput="updateKeywordCounts()" placeholder="Masukkan daftar keyword..." rows="1"></textarea>
        </div>

        <div class="keyword-field-container">
          <div class="keyword-top-controls">
            <label for="kw2">Daftar Keyword 2</label>
          </div>
          <textarea id="kw2" oninput="updateKeywordCounts()" placeholder="Masukkan daftar keyword..." rows="1"></textarea>
        </div>

        <div class="keyword-field-container">
          <div class="keyword-top-controls">
            <label for="kw3">Daftar Keyword 3</label>
          </div>
          <textarea id="kw3" oninput="updateKeywordCounts()" placeholder="Masukkan daftar keyword..." rows="1"></textarea>
        </div>
      </div>

      <div class="button-row" style="gap: 8px;">
        <button class="btn-generate-style" onclick="checkAll(true)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 11 12 14 22 4"/><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"/></svg>
            Select All
        </button>
        <button class="btn-select-style" onclick="checkAll(false)">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/></svg>
            Deselect
        </button>
      </div>

      <div id="keywordResults" class="keywords-result" aria-live="polite"></div>

      <div class="bottom-section">
        <strong>Terpilih:</strong> <span id="count">0</span> Keyword
        <div id="selectedKeywords" style="margin-top:6px;color:var(--subtext); overflow-wrap: break-word;"></div>
      </div>
    </div> <!-- Penutup #organizer-content -->
    </section>
  </main>

  <div id="toast"></div>

  <script src="countries.js"></script>
  <script src="excluded_keywords.js"></script>
  <script src="istock_instructions.js"></script>
  <script src="gemini_instructions.js"></script>
  <script src="adobe_instructions.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      updateKeywordAwalCount();
      updateKeywordCounts(); // Panggil saat load
      initializeOrganizerState(); // Panggil fungsi untuk set state awal organizer
      initializeIstockPromptState(); // Panggil fungsi untuk set state awal prompt istock
    });

    // --- FUNGSI NOTIFIKASI DINAMIS ---
    function showToast(message = "Berhasil diproses!", type = 'copy', ms = 1300){
        const t = document.getElementById('toast');
        t.textContent = message; 

        const colorVar = type === 'reset' ? '--notif-reset' : (type === 'copy' ? '--notif-copy' : '--btn-gen-fg'); 
        t.style.backgroundColor = getComputedStyle(document.body).getPropertyValue(colorVar).trim();
        
        t.classList.add('show');
        clearTimeout(t._h);
        t._h = setTimeout(()=> {
            t.classList.remove('show');
            t.style.backgroundColor = ''; 
        }, ms);
    }


    async function pasteTo(id){
      try {
        const txt = await navigator.clipboard.readText();
        document.getElementById(id).value = txt;
        showToast("Teks berhasil ditempel! üìã", 'copy'); 
        if (id === 'keywordAwal') {
            updateKeywordAwalCount();
        }
        if (id.startsWith('kw')) {
            updateKeywordCounts();
        }
        if (id === 'judul') {
            updateKeywordCounts();
        }
      } catch {
        showToast("Gagal paste ‚Äî periksa izin clipboard", 'reset');
      }
    }

    async function copyText(id){
      const val = document.getElementById(id).value;
      if (!val.trim()) { showToast("Kolom kosong. Tidak ada yang disalin!", 'reset'); return; }
      try {
        await navigator.clipboard.writeText(val);
        showToast("Teks berhasil disalin! ‚úÖ", 'copy');
      } catch {
        showToast("Gagal salin", 'reset');
      }
    }
    
    // --- FUNGSI HITUNG KEYWORD AWAL ---
    function updateKeywordAwalCount() {
        const k = document.getElementById('keywordAwal').value;
        const count = k.split(/[\n,]+/).map(s => s.trim()).filter(Boolean).length;
        document.getElementById('akhirCount').textContent = count;
    }

    // --- FUNGSI HITUNG KEYWORD DI ORGANIZER ---
    function updateKeywordCounts() {
        const kw1 = document.getElementById('kw1').value.trim();
        const kw2 = document.getElementById('kw2').value.trim();
        const kw3 = document.getElementById('kw3').value.trim();
        const judul = document.getElementById('judul').value.trim(); // Ambil nilai judul

        const count1 = kw1 ? (kw1.match(/[\n,]/g) || []).length + 1 : 0;
        const count2 = kw2 ? (kw2.match(/[\n,]/g) || []).length + 1 : 0;
        const count3 = kw3 ? (kw3.match(/[\n,]/g) || []).length + 1 : 0;

        // Update Tampilan Jumlah
        document.getElementById('kw1Count').textContent = count1;
        document.getElementById('kw2Count').textContent = count2;
        document.getElementById('kw3Count').textContent = count3;

        const total = count1 + count2 + count3;
        document.getElementById('allKeywordCount').textContent = total;

        // Update Indikator Status untuk Judul
        const judulStatusClass = judul ? 'status-filled' : 'status-empty';
        document.getElementById('judul-status').className = `keyword-status-badge ${judulStatusClass}`;
    }

    function _collectFrom(id){
      return document.getElementById(id).value
        .split(/[\n,]+/)
        .map(s => s.trim().toLowerCase())
        .filter(Boolean);
    }
    
    function organizeAndGenerate(){
      const all = ['kw1','kw2','kw3'].flatMap(_collectFrom);
      
      // Gabungkan daftar negara dan daftar keyword custom yang tersembunyi
      const exclusionList = [...countries, ...excludedCustomKeywords];

      // Proses filtering
      const filtered = all.filter(k => !exclusionList.includes(k));
      const unique = [...new Set(filtered)].sort((a,b) => a.localeCompare(b));
      
      const container = document.getElementById('keywordResults');
      container.innerHTML = '';
      if(unique.length === 0){
        showToast("Tidak ada keyword untuk diorganisir setelah filter", 'reset');
        updateSelected(); 
        return;
      }
      const frag = document.createDocumentFragment();
      unique.forEach(k => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" onchange="updateSelected()" checked> ${escapeHtml(k)}`;
        frag.appendChild(label);
      });
      container.appendChild(frag);
      updateSelected(); 

      // --- Logika Generate Prompt dipindahkan ke sini ---
      let j = document.getElementById('judul').value.trim();
      // Baca langsung dari #keywordAwal yang sudah pasti terupdate oleh updateSelected()
      let organizedKeywords = document.getElementById('keywordAwal').value.trim();

      if (!j || !organizedKeywords) {
          showToast("Judul dan Keyword Awal harus diisi!", 'reset');
          return;
      }

      if (j.startsWith('[') && j.endsWith(']')) { j = j.substring(1, j.length - 1); }

      const selectedType = document.querySelector('input[name="prompt-type"]:checked').value;
      let instructions = '';
      let platformName = '';

      if (selectedType === 'adobe') {
          instructions = ADOBE_STOCK_INSTRUCTIONS;
          platformName = 'Adobe Stock';
      } else if (selectedType === 'istock') {
          instructions = ISTOCK_INSTRUCTIONS;
          platformName = 'iStock';
      } else if (selectedType === 'gemini') {
          instructions = GEMINI_INSTRUCTIONS;
          platformName = 'Gemini';
      }

      const hasil = `Judul: [${j}]\n\nKeyword: [${organizedKeywords}]\n\n${instructions}`;
      document.getElementById('hasilPrompt').value = hasil;
      showToast(`Prompt ${platformName} berhasil dibuat ‚ö°`, 'generate');
    }

    function escapeHtml(str){
      return str.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    function updateSelected(){
      const checkedInputs = Array.from(document.querySelectorAll('#keywordResults input[type="checkbox"]:checked'));
      const values = checkedInputs.map(input => input.parentNode.textContent.trim());
      const keywordsString = values.join(', '); 
      
      document.getElementById('selectedKeywords').textContent = keywordsString;
      document.getElementById('count').textContent = values.length;
      document.getElementById('keywordAwal').value = keywordsString; 
      updateKeywordAwalCount(); 
    }

    function checkAll(state){
      const inputs = document.querySelectorAll('#keywordResults input[type="checkbox"]');
      inputs.forEach(i => i.checked = state);
      updateSelected();
      showToast(state ? "Semua keyword terpilih" : "Semua keyword dibatalkan", state ? 'copy' : 'reset');
    }

    function resetAll(){
      // Reset semua kolom input pengguna
      document.getElementById('judul').value = '';
      document.getElementById('keywordAwal').value = '';
      document.getElementById('hasilPrompt').value = '';
      document.getElementById('kw1').value = '';
      document.getElementById('kw2').value = '';
      document.getElementById('kw3').value = '';
      document.getElementById('keywordResults').innerHTML = '';
      document.getElementById('selectedKeywords').textContent = '';
      document.getElementById('count').textContent = '0';
      updateKeywordAwalCount(); 
      updateKeywordCounts();
      showToast("Semua kolom berhasil direset üóëÔ∏è", 'reset');
    }

    function clearField(id){ 
        document.getElementById(id).value = ''; 
        showToast("Kolom dihapus üóëÔ∏è", 'reset');
        
        if(id === 'keywordAwal') {
             document.getElementById('selectedKeywords').textContent = '';
             document.getElementById('count').textContent = '0';
             updateKeywordAwalCount();
        }
        if (id.startsWith('kw')) {
            updateKeywordCounts();
        }
        if (id === 'judul') {
            updateKeywordCounts();
        }
    }

    document.addEventListener('keydown', e => {
      if((e.ctrlKey || e.metaKey) && e.key === 'Enter'){
        e.preventDefault();
        organizeAndGenerate();
      }
    });

    // --- FUNGSI MINIMIZE/MAXIMIZE KEYWORD ORGANIZER ---
    const toggleBtn = document.getElementById('toggle-organizer-btn');
    const organizerContent = document.getElementById('organizer-content');
    const keywordSection = document.getElementById('keyword-section');

    function initializeOrganizerState() {
        // Default state: minimized
        keywordSection.classList.add('minimized');
        organizerContent.style.display = 'none';
    }

    toggleBtn.addEventListener('click', () => {
        const isMinimized = keywordSection.classList.toggle('minimized');
        if (isMinimized) {
            organizerContent.style.display = 'none';
            toggleBtn.title = "Buka Organizer";
        } else {
            organizerContent.style.display = 'block';
            toggleBtn.title = "Tutup Organizer";
        }
    });
    // --- FUNGSI THEME TOGGLE ---
    const themeToggle = document.getElementById('theme-toggle');
    
    // Fungsi untuk mengatur tema saat halaman dimuat
    function initializeTheme() {
        // Default ke dark mode jika tidak ada preferensi tersimpan
        document.body.setAttribute('data-theme', 'dark');
    }

    themeToggle.addEventListener('click', () => {
        const currentTheme = document.body.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        document.body.setAttribute('data-theme', newTheme);
    });

    // --- FUNGSI MINIMIZE/MAXIMIZE PROMPT KEYWORD ISTOCK ---
    const toggleIstockPromptBtn = document.getElementById('toggle-istock-prompt-btn');
    const istockPromptContent = document.getElementById('istock-prompt-content');
    const istockPromptSection = document.getElementById('istock-prompt');

    function initializeIstockPromptState() {
        // Default state: minimized
        istockPromptSection.classList.add('minimized');
        istockPromptContent.style.display = 'none';
        toggleIstockPromptBtn.title = "Buka Prompt";
    }

    toggleIstockPromptBtn.addEventListener('click', () => {
        const isMinimized = istockPromptSection.classList.toggle('minimized');
        if (isMinimized) {
            istockPromptContent.style.display = 'none';
            toggleIstockPromptBtn.title = "Buka Prompt";
        } else {
            istockPromptContent.style.display = 'block';
            toggleIstockPromptBtn.title = "Tutup Prompt";
        }
    });
    initializeTheme(); // Panggil fungsi saat script dimuat
  </script>
</body>
</html>
